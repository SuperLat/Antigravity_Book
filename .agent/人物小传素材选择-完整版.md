# 人物小传素材选择功能 - 完整版

## ✅ 已完成功能

### 1. 状态管理
```typescript
const [showCharacterContextSelector, setShowCharacterContextSelector] = useState(false);
const [selectedCharacterFields, setSelectedCharacterFields] = useState<string[]>([
  'spark', 'core', 'synopsis', 'genre', 'background', 'length', 'worldview'
]);
const [customCharacterContext, setCustomCharacterContext] = useState('');
```

### 2. 可选字段（共7个）
- ✅ 核心灵感 (spark)
- ✅ 故事内核 (core)
- ✅ 故事概要 (synopsis)
- ✅ 故事类型 (genre) ⭐ 新增
- ✅ 故事背景 (background) ⭐ 新增
- ✅ 故事篇幅 (length) ⭐ 新增
- ✅ 世界观设定 (worldview)

### 3. 动态上下文构建
修改了 `handleGenerateCharacters` 函数：
```typescript
const fieldMap: Record<string, { key: string; value: any }> = {
  spark: { key: 'spark', value: activeIdea.spark },
  core: { key: 'core', value: activeIdea.storyCore },
  synopsis: { key: 'synopsis', value: activeIdea.storySynopsis },
  genre: { key: 'genre', value: activeIdea.storyGenre },
  background: { key: 'background', value: activeIdea.storyBackground },
  length: { key: 'storyLength', value: activeIdea.storyLength },
  worldview: { key: 'worldview', value: activeIdea.worldview },
};
```

### 4. UI组件特性
- **位置**: 人物列表左侧，可折叠
- **布局**: 左右分栏（左侧320px固定，右侧自适应）
- **动画**: 滑入效果
- **默认状态**: 默认选中所有7个字段
- **自定义文本**: 支持输入额外的人物设定要求
- **快捷操作**: 
  - 全选按钮（选中所有7个字段）
  - 清空按钮
- **关闭方式**: 
  - 点击面板右上角X按钮
  - 再次点击"选择素材"按钮

### 5. 字段可用性检测
- 未填写的字段自动禁用（灰色显示）
- 故事篇幅字段始终可用（因为有默认值）
- 只有已填写的字段才能被选中

## 🎯 使用流程

1. 在人物小传阶段，点击"选择素材"按钮
2. 查看默认已选中的7个字段
3. 根据需要勾选/取消字段
4. 可选：输入额外的人物设定要求
5. 点击"生成人物"按钮
6. AI 基于选中的素材生成人物小传

## 📊 字段对比

### 世界观生成（6个字段）
- 核心灵感、故事内核、故事概要
- 故事类型、故事背景、故事篇幅

### 人物小传生成（7个字段）
- 核心灵感、故事内核、故事概要
- 故事类型、故事背景、故事篇幅
- **世界观设定** ⭐ 人物生成特有

## 💡 设计理念

1. **完整性**: 包含所有可能影响人物设定的字段
2. **灵活性**: 用户可以完全控制上下文内容
3. **默认友好**: 默认选中所有字段，保持原有体验
4. **智能提示**: 未填写字段自动禁用，避免误选

## ✨ 完成状态

- ✅ **世界观生成** - 6个可选字段
- ✅ **人物小传生成** - 7个可选字段
- ⏳ **大纲生成** - 待实现
- ⏳ **分卷生成** - 待实现
- ⏳ **细纲生成** - 待实现

## 🔄 下一步建议

为大纲生成添加素材选择功能，可选字段包括：
- 核心灵感、故事内核、故事概要
- 故事类型、故事背景、故事篇幅
- 世界观设定
- **人物小传** ⭐ 大纲生成特有
